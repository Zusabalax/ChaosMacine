name: Discord PR Notifications

on:
  pull_request:
    types: [opened, closed, reopened, ready_for_review]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Determine Color
        id: color
        run: |
          if [ "${{ github.event.action }}" = "opened" ]; then
            echo "color=3066993" >> $GITHUB_OUTPUT
          elif [ "${{ github.event.action }}" = "closed" ]; then
            if [ "${{ github.event.pull_request.merged }}" = "true" ]; then
              echo "color=15105570" >> $GITHUB_OUTPUT
            else
              echo "color=15158332" >> $GITHUB_OUTPUT
            fi
          else
            echo "color=3447003" >> $GITHUB_OUTPUT
          fi

      - name: Send Discord Notification
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          status: ${{ job.status }}
          embed: |
            {
              "title": "Pull Request ${{ github.event.action }}",
              "color": ${{ steps.color.outputs.color }},
              "fields": [
                {
                  "name": "Repositório",
                  "value": "${{ github.repository }}",
                  "inline": true
                },
                {
                  "name": "Autor",
                  "value": "${{ github.event.pull_request.user.login }}",
                  "inline": true
                },
                {
                  "name": "Título",
                  "value": "${{ github.event.pull_request.title }}"
                }
              ],
              "timestamp": "${{ github.event.pull_request.updated_at }}"
            }
